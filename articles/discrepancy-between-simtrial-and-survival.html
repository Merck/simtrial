<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Note on potential discrepancies between simtrial and survdiff • simtrial</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Note on potential discrepancies between simtrial and survdiff">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">simtrial</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Merck/simtrial/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Note on potential discrepancies between simtrial and survdiff</h1>
                        <h4 data-toc-skip class="author">Larry Leon</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Merck/simtrial/blob/main/vignettes/discrepancy-between-simtrial-and-survival.Rmd" class="external-link"><code>vignettes/discrepancy-between-simtrial-and-survival.Rmd</code></a></small>
      <div class="d-none name"><code>discrepancy-between-simtrial-and-survival.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://keaven.github.io/gsDesign/" class="external-link">gsDesign</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://merck.github.io/gsDesign2/" class="external-link">gsDesign2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com" class="external-link">gt</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://merck.github.io/simtrial/">simtrial</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></code></pre></div>
<p>In the survival (base R) package, the log-rank and Cox estimation
procedures apply (by default) a correction to “fix” roundoff errors.
These are implemented with the <code>timefix</code> option (by default
<code>timefix = TRUE</code>) via the <code><a href="https://rdrr.io/pkg/survival/man/aeqSurv.html" class="external-link">aeqSurv()</a></code> function.
However, in the simtrial package, (and also Hmisc), such a correction is
not implemented; Consequently, there can be discrepancies between
simtrial and base R survival (<code><a href="https://rdrr.io/pkg/survival/man/survdiff.html" class="external-link">survdiff()</a></code>,
<code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph()</a></code>, and <code><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit()</a></code>).</p>
<p>For details on the <code><a href="https://rdrr.io/pkg/survival/man/aeqSurv.html" class="external-link">aeqSurv()</a></code> function, see <a href="https://cran.r-project.org/package=survival/vignettes/tiedtimes.pdf" class="external-link">Therneau,
2016</a> and the <code><a href="https://rdrr.io/pkg/survival/man/aeqSurv.html" class="external-link">?aeqSurv</a></code> function documentation.</p>
<p>In the following, we describe a simulation scenario where a
discrepancy is generated and illustrate how discrepancies can be
resolved (if desired) by pre-processing survival times with
<code><a href="https://rdrr.io/pkg/survival/man/aeqSurv.html" class="external-link">aeqSurv()</a></code> and thus replicating <code><a href="https://rdrr.io/pkg/survival/man/survdiff.html" class="external-link">survdiff()</a></code> and
<code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph()</a></code> default calculations.</p>
<p>In the simulated dataset, two observations are generated:</p>
<ul>
<li>Observation <span class="math inline">\(i=464\)</span> with survival
time <span class="math inline">\(Y=0.306132722582\)</span>.</li>
<li>Observation <span class="math inline">\(i=516\)</span> with survival
time <span class="math inline">\(Y=0.306132604679\)</span>.</li>
<li>Per <code><a href="https://rdrr.io/pkg/survival/man/aeqSurv.html" class="external-link">aeqSurv()</a></code>, these times are tied and set to <span class="math inline">\(Y=0.306132604679\)</span>.</li>
<li>The log-rank and Cox estimates can therefore differ between other
approaches without the “timefix” correction.</li>
</ul>
</div>
<div class="section level2">
<h2 id="scenario-definitions">Scenario definitions<a class="anchor" aria-label="anchor" href="#scenario-definitions"></a>
</h2>
<p>We define various true data generating model scenarios and convert
for use in gsDesign2. Here, we are using a single scenario where
discrepancies were found. This is just for illustration to inform the
user of simtrial that discrepancies can occur and how to resolve via
<code><a href="https://rdrr.io/pkg/survival/man/aeqSurv.html" class="external-link">aeqSurv()</a></code>, if desired.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survival_at_24_months</span> <span class="op">&lt;-</span> <span class="fl">0.35</span></span>
<span><span class="va">hr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.35</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.25</span><span class="op">)</span></span>
<span><span class="va">control_median</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span><span class="va">control_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="va">control_median</span>, <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.25</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.2</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">Scenario</span>, <span class="op">~</span><span class="va">Name</span>,           <span class="op">~</span><span class="va">Period</span>, <span class="op">~</span><span class="va">duration</span>, <span class="op">~</span><span class="va">Survival</span>,</span>
<span>  <span class="fl">0</span>,         <span class="st">"Control"</span>,       <span class="fl">0</span>,       <span class="fl">0</span>,         <span class="fl">1</span>,</span>
<span>  <span class="fl">0</span>,         <span class="st">"Control"</span>,       <span class="fl">1</span>,       <span class="fl">24</span>,        <span class="fl">.25</span>,</span>
<span>  <span class="fl">0</span>,         <span class="st">"Control"</span>,       <span class="fl">2</span>,       <span class="fl">12</span>,        <span class="fl">.2</span>,</span>
<span>  <span class="fl">1</span>,         <span class="st">"PH"</span>,            <span class="fl">0</span>,       <span class="fl">0</span>,         <span class="fl">1</span>,</span>
<span>  <span class="fl">1</span>,         <span class="st">"PH"</span>,            <span class="fl">1</span>,       <span class="fl">24</span>,        <span class="fl">.35</span>,</span>
<span>  <span class="fl">1</span>,         <span class="st">"PH"</span>,            <span class="fl">2</span>,       <span class="fl">12</span>,        <span class="fl">.2</span><span class="op">^</span><span class="va">hr</span>,</span>
<span>  <span class="fl">2</span>,         <span class="st">"3-month delay"</span>, <span class="fl">0</span>,       <span class="fl">0</span>,         <span class="fl">1</span>,</span>
<span>  <span class="fl">2</span>,         <span class="st">"3-month delay"</span>, <span class="fl">1</span>,       <span class="fl">3</span>,         <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span> <span class="op">*</span> <span class="va">control_rate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fl">2</span>,         <span class="st">"3-month delay"</span>, <span class="fl">2</span>,       <span class="fl">21</span>,        <span class="fl">.35</span>,</span>
<span>  <span class="fl">2</span>,         <span class="st">"3-month delay"</span>, <span class="fl">3</span>,       <span class="fl">12</span>,        <span class="fl">.2</span><span class="op">^</span><span class="va">hr</span>,</span>
<span>  <span class="fl">3</span>,         <span class="st">"6-month delay"</span>, <span class="fl">0</span>,       <span class="fl">0</span>,         <span class="fl">1</span>,</span>
<span>  <span class="fl">3</span>,         <span class="st">"6-month delay"</span>, <span class="fl">1</span>,       <span class="fl">6</span>,         <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6</span> <span class="op">*</span> <span class="va">control_rate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fl">3</span>,         <span class="st">"6-month delay"</span>, <span class="fl">2</span>,       <span class="fl">18</span>,        <span class="fl">.35</span>,</span>
<span>  <span class="fl">3</span>,         <span class="st">"6-month delay"</span>, <span class="fl">3</span>,       <span class="fl">12</span>,        <span class="fl">.2</span><span class="op">^</span><span class="va">hr</span>,</span>
<span>  <span class="fl">4</span>,         <span class="st">"Crossing"</span>,      <span class="fl">0</span>,       <span class="fl">0</span>,         <span class="fl">1</span>,</span>
<span>  <span class="fl">4</span>,         <span class="st">"Crossing"</span>,      <span class="fl">1</span>,       <span class="fl">3</span>,         <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span> <span class="op">*</span> <span class="va">control_rate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fl">1.3</span><span class="op">)</span>,</span>
<span>  <span class="fl">4</span>,         <span class="st">"Crossing"</span>,      <span class="fl">2</span>,       <span class="fl">21</span>,        <span class="fl">.35</span>,</span>
<span>  <span class="fl">4</span>,         <span class="st">"Crossing"</span>,      <span class="fl">3</span>,       <span class="fl">12</span>,        <span class="fl">.2</span><span class="op">^</span><span class="va">hr</span>,</span>
<span>  <span class="fl">5</span>,         <span class="st">"Weak null"</span>,     <span class="fl">0</span>,       <span class="fl">0</span>,         <span class="fl">1</span>,</span>
<span>  <span class="fl">5</span>,         <span class="st">"Weak null"</span>,     <span class="fl">1</span>,       <span class="fl">24</span>,        <span class="fl">.25</span>,</span>
<span>  <span class="fl">5</span>,         <span class="st">"Weak null"</span>,     <span class="fl">2</span>,       <span class="fl">12</span>,        <span class="fl">.2</span>,</span>
<span>  <span class="fl">6</span>,         <span class="st">"Strong null"</span>,   <span class="fl">0</span>,       <span class="fl">0</span>,         <span class="fl">1</span>,</span>
<span>  <span class="fl">6</span>,         <span class="st">"Strong null"</span>,   <span class="fl">1</span>,       <span class="fl">3</span>,         <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span> <span class="op">*</span> <span class="va">control_rate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>  <span class="fl">6</span>,         <span class="st">"Strong null"</span>,   <span class="fl">2</span>,       <span class="fl">3</span>,         <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6</span> <span class="op">*</span> <span class="va">control_rate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fl">6</span>,         <span class="st">"Strong null"</span>,   <span class="fl">3</span>,       <span class="fl">18</span>,        <span class="fl">.25</span>,</span>
<span>  <span class="fl">6</span>,         <span class="st">"Strong null"</span>,   <span class="fl">4</span>,       <span class="fl">12</span>,        <span class="fl">.2</span>,</span>
<span><span class="op">)</span></span>
<span><span class="co"># scenarios |&gt; gt()</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fr</span> <span class="op">&lt;-</span> <span class="va">scenarios</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Scenario</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co">#  filter(Scenario == 2) |&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">duration</span><span class="op">)</span>,</span>
<span>    x_rate <span class="op">=</span> <span class="op">-</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Survival</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">Survival</span>, default <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span></span>
<span>      <span class="va">duration</span>,</span>
<span>    rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Month</span> <span class="op">&gt;</span> <span class="fl">24</span>, <span class="va">control_rate</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">control_rate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    hr <span class="op">=</span> <span class="va">x_rate</span> <span class="op">/</span> <span class="va">rate</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">x_rate</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Period</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="va">Scenario</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># fr |&gt; gt() |&gt; fmt_number(columns = everything(), decimals = 2)</span></span>
<span></span>
<span><span class="va">fr</span> <span class="op">&lt;-</span> <span class="va">fr</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fail_rate <span class="op">=</span> <span class="va">rate</span>, dropout_rate <span class="op">=</span> <span class="fl">0.001</span>, stratum <span class="op">=</span> <span class="st">"All"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># MWLR</span></span>
<span><span class="va">mwlr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://merck.github.io/gsDesign2/reference/fixed_design.html" class="external-link">fixed_design_mb</a></span><span class="op">(</span></span>
<span>  tau <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  enroll_rate <span class="op">=</span> <span class="fu"><a href="https://merck.github.io/gsDesign2/reference/define_enroll_rate.html" class="external-link">define_enroll_rate</a></span><span class="op">(</span>duration <span class="op">=</span> <span class="fl">12</span>, rate <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  fail_rate <span class="op">=</span> <span class="va">fr</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Scenario</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.025</span>, power <span class="op">=</span> <span class="fl">.85</span>, ratio <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  study_duration <span class="op">=</span> <span class="fl">36</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://merck.github.io/gsDesign2/reference/to_integer.html" class="external-link">to_integer</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">er</span> <span class="op">&lt;-</span> <span class="va">mwlr</span><span class="op">$</span><span class="va">enroll_rate</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-scenario-that-generates-a-discrepancy">A scenario that generates a discrepancy<a class="anchor" aria-label="anchor" href="#a-scenario-that-generates-a-discrepancy"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3219</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dgm</span> <span class="op">&lt;-</span> <span class="va">fr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span><span class="op">:</span><span class="fl">17</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">fail_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  stratum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dgm</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">dgm</span><span class="op">$</span><span class="va">Period</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"control"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dgm</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"experimental"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dgm</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">dgm</span><span class="op">$</span><span class="va">duration</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dgm</span><span class="op">$</span><span class="va">rate</span>, <span class="va">dgm</span><span class="op">$</span><span class="va">rate</span> <span class="op">*</span> <span class="va">dgm</span><span class="op">$</span><span class="va">hr</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">dgm</span><span class="op">$</span><span class="va">stratum</span> <span class="op">&lt;-</span> <span class="st">"All"</span></span>
<span><span class="co"># Constant dropout rate for both treatment arms and all scenarios</span></span>
<span><span class="va">dropout_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  stratum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"control"</span>, <span class="st">"experimental"</span><span class="op">)</span>,</span>
<span>  duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.001</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Simulated dataset with discrepancy between logrank test of
<code><a href="../reference/wlr.html">simtrial::wlr()</a></code> and <code><a href="https://rdrr.io/pkg/survival/man/survdiff.html" class="external-link">survdiff()</a></code> (also compare
to score test of <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph()</a></code> [same as <code><a href="https://rdrr.io/pkg/survival/man/survdiff.html" class="external-link">survdiff()</a></code>
with default <code>timefix = TRUE</code>]).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss</span> <span class="op">&lt;-</span> <span class="fl">395</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">8316951</span> <span class="op">+</span> <span class="va">ss</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate a dataset</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_pw_surv.html">sim_pw_surv</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">698</span>,</span>
<span>  enroll_rate <span class="op">=</span> <span class="va">er</span>,</span>
<span>  fail_rate <span class="op">=</span> <span class="va">fail_rate</span>,</span>
<span>  dropout_rate <span class="op">=</span> <span class="va">dropout_rate</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">analysis_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cut_data_by_date.html">cut_data_by_date</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fl">36</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dfa</span> <span class="op">&lt;-</span> <span class="va">analysis_data</span></span>
<span></span>
<span><span class="va">dfa</span><span class="op">$</span><span class="va">treat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dfa</span><span class="op">$</span><span class="va">treatment</span> <span class="op">==</span> <span class="st">"experimental"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">z1</span> <span class="op">&lt;-</span> <span class="va">dfa</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/wlr.html">wlr</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="../reference/fh.html">fh</a></span><span class="op">(</span>rho <span class="op">=</span> <span class="fl">0</span>, gamma <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">check</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survdiff.html" class="external-link">survdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">tte</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">dfa</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Note, for `coxph()`, use</span></span>
<span><span class="co"># cph.score &lt;- summary(coxph(Surv(tte, event) ~ treat, data = dfa, control = coxph.control(timefix = TRUE)))$sctest</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Log-rank wlr() vs survdiff()"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">z1</span><span class="op">$</span><span class="va">z</span><span class="op">^</span><span class="fl">2</span>, <span class="va">check</span><span class="op">$</span><span class="va">chisq</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Log-rank wlr() vs survdiff() 0.1577428 0.1577954</span></span></code></pre>
<p>Verify that <code>timefix = FALSE</code> in <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph()</a></code>
agrees with <code><a href="../reference/wlr.html">wlr()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cph.score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">tte</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">treat</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dfa</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.control.html" class="external-link">coxph.control</a></span><span class="op">(</span>timefix <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">sctest</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Log-rank wlr() vs Cox score z^2"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">z1</span><span class="op">$</span><span class="va">z</span><span class="op">^</span><span class="fl">2</span>, <span class="va">cph.score</span><span class="op">[</span><span class="st">"test"</span><span class="op">]</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Log-rank wlr() vs Cox score z^2 0.1577428 0.1577428</span></span></code></pre>
<p>Pre-processing survival times with <code><a href="https://rdrr.io/pkg/survival/man/aeqSurv.html" class="external-link">aeqSurv()</a></code> to
implement <code>timefix = TRUE</code> procedure.</p>
<p>Verify <code><a href="../reference/wlr.html">wlr()</a></code> and <code><a href="https://rdrr.io/pkg/survival/man/survdiff.html" class="external-link">survdiff()</a></code> now agree.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">dfa</span><span class="op">[</span>, <span class="st">"tte"</span><span class="op">]</span></span>
<span><span class="va">Delta</span> <span class="op">&lt;-</span> <span class="va">dfa</span><span class="op">[</span>, <span class="st">"event"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">tfixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/aeqSurv.html" class="external-link">aeqSurv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">Delta</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">tfixed</span><span class="op">[</span>, <span class="st">"time"</span><span class="op">]</span></span>
<span><span class="va">Delta</span> <span class="op">&lt;-</span> <span class="va">tfixed</span><span class="op">[</span>, <span class="st">"status"</span><span class="op">]</span></span>
<span><span class="co"># Use aeqSurv version</span></span>
<span><span class="va">dfa</span><span class="op">$</span><span class="va">tte2</span> <span class="op">&lt;-</span> <span class="va">Y</span></span>
<span><span class="va">dfa</span><span class="op">$</span><span class="va">event2</span> <span class="op">&lt;-</span> <span class="va">Delta</span></span>
<span></span>
<span><span class="co"># wlr() after "timefix"</span></span>
<span><span class="va">dfa2</span> <span class="op">&lt;-</span> <span class="va">dfa</span></span>
<span><span class="va">dfa2</span><span class="op">$</span><span class="va">tte</span> <span class="op">&lt;-</span> <span class="va">dfa2</span><span class="op">$</span><span class="va">tte2</span></span>
<span><span class="va">dfa2</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="va">dfa2</span><span class="op">$</span><span class="va">event2</span></span>
<span><span class="va">z1new</span> <span class="op">&lt;-</span> <span class="va">dfa2</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/wlr.html">wlr</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="../reference/fh.html">fh</a></span><span class="op">(</span>rho <span class="op">=</span> <span class="fl">0</span>, gamma <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Log-rank wlr() with timefix vs survdiff() z^2"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">z1new</span><span class="op">$</span><span class="va">z</span><span class="op">^</span><span class="fl">2</span>, <span class="va">check</span><span class="op">$</span><span class="va">chisq</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Log-rank wlr() with timefix vs survdiff() z^2 0.1577954 0.1577954</span></span></code></pre>
<p>Where do they differ (<code>tte2</code> are times after
<code><a href="https://rdrr.io/pkg/survival/man/aeqSurv.html" class="external-link">aeqSurv()</a></code>)?</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfa</span> <span class="op">&lt;-</span> <span class="va">dfa</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">dfa</span><span class="op">$</span><span class="va">tte2</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dfa</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">dfa</span><span class="op">$</span><span class="va">tte</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">dfa</span><span class="op">$</span><span class="va">tte2</span><span class="op">)</span></span>
<span><span class="va">id_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tolook</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">id_diff</span> <span class="op">-</span> <span class="fl">2</span>, <span class="va">id_diff</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dfcheck</span> <span class="op">&lt;-</span> <span class="va">dfa</span><span class="op">[</span><span class="va">tolook</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tte"</span>, <span class="st">"tte2"</span>, <span class="st">"event"</span>, <span class="st">"event2"</span>, <span class="st">"treatment"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dfcheck</span>, digits <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                tte           tte2 event event2    treatment</span></span>
<span><span class="co">## 13  0.276251560170 0.276251560170     1      1 experimental</span></span>
<span><span class="co">## 143 0.298789385712 0.298789385712     1      1      control</span></span>
<span><span class="co">## 464 0.306132722582 0.306132604679     1      1      control</span></span>
<span><span class="co">## 516 0.306132604679 0.306132604679     1      1 experimental</span></span>
<span><span class="co">## 605 0.336489970678 0.336489970678     1      1 experimental</span></span></code></pre>
<p>Verify <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph()</a></code> (default) and <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph()</a></code> with
<code><a href="https://rdrr.io/pkg/survival/man/aeqSurv.html" class="external-link">aeqSurv()</a></code> pre-processing (using <code>tte2</code> as
outcome and setting <code>timefix = FALSE</code>) are identical:</p>
<p>Also note that here ties do not have impact because in separate
arms.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check Cox with ties</span></span>
<span><span class="va">cox_breslow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">tte</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">treatment</span>, data <span class="op">=</span> <span class="va">dfa</span>, ties <span class="op">=</span> <span class="st">"breslow"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span></span>
<span><span class="va">cox_efron</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">tte</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">treatment</span>, data <span class="op">=</span> <span class="va">dfa</span>, ties <span class="op">=</span> <span class="st">"efron"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Cox Breslow and Efron hr (tte, timefix=TRUE):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cox_breslow</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">cox_efron</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Cox Breslow and Efron hr (tte, timefix=TRUE): 0.9657106 0.9657106</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Here ties do not have impact because in separate arms</span></span>
<span><span class="va">cox_breslow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">tte2</span>, <span class="va">event2</span><span class="op">)</span> <span class="op">~</span> <span class="va">treatment</span>, data <span class="op">=</span> <span class="va">dfa</span>, ties <span class="op">=</span> <span class="st">"breslow"</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.control.html" class="external-link">coxph.control</a></span><span class="op">(</span>timefix <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span></span>
<span><span class="va">cox_efron</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">tte2</span>, <span class="va">event2</span><span class="op">)</span> <span class="op">~</span> <span class="va">treatment</span>, data <span class="op">=</span> <span class="va">dfa</span>, ties <span class="op">=</span> <span class="st">"efron"</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.control.html" class="external-link">coxph.control</a></span><span class="op">(</span>timefix <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Cox Breslow and Efron hr (tte2, timefix=FALSE):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cox_breslow</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">cox_efron</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Cox Breslow and Efron hr (tte2, timefix=FALSE): 0.9657106 0.9657106</span></span></code></pre>
<p><strong>So here there is a difference between <code>tte</code> and
<code>tte2</code> times, but there is not an impact of ties for Cox
between <code>"breslow"</code> and <code>"efron"</code> because the ties
(single tie in <code>tte2</code>) are in separate arms</strong>.</p>
<p>Lastly, artificially change treatment so that two observations are
tied within the same treatment arm which generates difference between
<code>"breslow"</code> and <code>"efron"</code> options for
<code>ties</code>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create tie within treatment arm by changing treatment</span></span>
<span><span class="va">dfa3</span> <span class="op">&lt;-</span> <span class="va">dfa</span></span>
<span><span class="va">dfa3</span><span class="op">[</span><span class="fl">19</span>, <span class="st">"treat"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1.0</span></span>
<span></span>
<span><span class="va">cox_breslow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">tte</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">dfa3</span>, ties <span class="op">=</span> <span class="st">"breslow"</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.control.html" class="external-link">coxph.control</a></span><span class="op">(</span>timefix <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span></span>
<span><span class="va">cox_efron</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">tte</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">dfa3</span>, ties <span class="op">=</span> <span class="st">"efron"</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.control.html" class="external-link">coxph.control</a></span><span class="op">(</span>timefix <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Cox Breslow and Efron hr (tte, timefix=TRUE)="</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cox_breslow</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">cox_efron</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Cox Breslow and Efron hr (tte, timefix=TRUE)= 0.9729723 0.9729778</span></span></code></pre>
<p>Same as</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cox_breslow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">tte2</span>, <span class="va">event2</span><span class="op">)</span> <span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">dfa3</span>, ties <span class="op">=</span> <span class="st">"breslow"</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.control.html" class="external-link">coxph.control</a></span><span class="op">(</span>timefix <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span></span>
<span><span class="va">cox_efron</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">tte2</span>, <span class="va">event2</span><span class="op">)</span> <span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">dfa3</span>, ties <span class="op">=</span> <span class="st">"efron"</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.control.html" class="external-link">coxph.control</a></span><span class="op">(</span>timefix <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Cox Breslow and Efron hr (tte2, timefix=FALSE)="</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cox_breslow</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">cox_efron</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Cox Breslow and Efron hr (tte2, timefix=FALSE)= 0.9729723 0.9729778</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Keaven Anderson, Yujie Zhao, Yilong Zhang. Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2. <br>Copyright © 2024 Merck &amp; Co., Inc., Rahway, NJ, USA and its affiliates. All rights reserved.</p>
</div>

<div class="pkgdown-footer-right">
  <p><span></span></p>
</div>

    </footer>
</div>





  </body>
</html>
