<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Keaven Anderson" />

<meta name="date" content="2020-08-20" />

<title>Basic tools for time-to-event trial simulation and testing</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Basic tools for time-to-event trial simulation and testing</h1>
<h4 class="author">Keaven Anderson</h4>
<h4 class="date">2020-08-20</h4>



<div id="overview" class="section level2">
<h2>Overview</h2>
<p>This vignette demonstrates the lower-level routines in the simtrial package specifically related to trial generation and statistical testing.</p>
<p>The routines are as follows:</p>
<ul>
<li><code>fixedBlockRand</code> - fixed block randomization</li>
<li><code>rpwenroll</code> - random inter-arrival times with piecewise constant enrollment rates</li>
<li><code>rpwexp</code> - piecewise exponential failure rate generation</li>
<li><code>cutData</code> - cut data for analysis at a specified calendar time</li>
<li><code>cutDataAtCount</code> - cut data for analysis at a specified event count, including ties on the cutoff date</li>
<li><code>getCutDateForCount</code> - find date at which an event count is reached</li>
<li><code>tensurv</code> - pre-process survival data into a counting process format</li>
</ul>
<p>Application of the above is demonstrated using higher-level routines <code>simPWSurv()</code> and <code>simfix()</code> to generate simulations and weighted logrank analysis for a stratified design.</p>
<p>The intent has been to write these routines in the spirit of the tidyverse approach (alternately referred to as data wrangling, tidy data, R for Data Science, or split-apply-combine). The other objectives are to have an easily documentable and validated package that is easy to use and efficient as a broadly-useful tool for simulation of time-to-event clinical trials.</p>
<p>The package could be extended in many ways in the future, including:</p>
<ul>
<li>Other analyses not supported in the survival package or other acceptably validated package
<ul>
<li>Weighted logrank and weighted Kaplan-Meier analyses</li>
<li>One-step, hazard ratio estimator (first-order approximation of PH)</li>
</ul></li>
<li>Randomization schemes other than stratified, fixed-block</li>
<li>Poisson mixture or other survival distribution generation</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(simtrial)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(knitr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">library</span>(tibble)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">library</span>(dplyr)</a></code></pre></div>
</div>
<div id="randomization" class="section level2">
<h2>Randomization</h2>
<p>Fixed block randomization with an arbitrary block contents is performed as demonstrated below. In this case we have a block size of 5 with one string repeated twice in each block and three other strings appearing once each.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">fixedBlockRand</span>(<span class="dt">n=</span><span class="dv">10</span>,<span class="dt">block=</span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;Dog&quot;</span>,<span class="st">&quot;Cat&quot;</span>,<span class="st">&quot;Cat&quot;</span>))</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt;  [1] &quot;Cat&quot; &quot;A&quot;   &quot;Dog&quot; &quot;Cat&quot; &quot;Cat&quot; &quot;A&quot;   &quot;Cat&quot; &quot;Dog&quot; &quot;Cat&quot; &quot;Cat&quot;</span></a></code></pre></div>
<p>More normally, with a default of blocks of size four:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">fixedBlockRand</span>(<span class="dt">n=</span><span class="dv">20</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt;  [1] 0 1 1 0 1 0 1 0 1 0 0 1 1 0 0 1 1 0 1 0</span></a></code></pre></div>
</div>
<div id="enrollment" class="section level2">
<h2>Enrollment</h2>
<p>Piecewise constant enrollment can be randomly generated as follows. Note that duration is specifies interval durations for constant rates; the final rate is extended as long as needed to generate the specified number of observations.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">rpwenroll</span>(<span class="dt">n =</span> <span class="dv">20</span>, <span class="dt">enrollRates =</span> <span class="kw">tibble</span>(<span class="dt">duration =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), </a>
<a class="sourceLine" id="cb4-2" data-line-number="2">                                       <span class="dt">rate =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">5</span>)))</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt;  [1] 0.9600751 1.0517603 1.2143467 1.4189138 1.8334299 1.9282644 1.9859801</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt;  [8] 2.4239543 2.9631974 3.2517742 3.4913787 3.6676683 3.6787655 3.7624922</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; [15] 3.9692146 4.0794079 4.1086844 4.6368999 4.7125368 4.8553077</span></a></code></pre></div>
</div>
<div id="time-to-event-and-time-to-dropout" class="section level2">
<h2>Time-to-event and time-to-dropout</h2>
<p>Time-to-event and time-to-dropout random number generation for observations is generated with piecewise exponential failure times. For a large number of observations, a log-plot of the time-to-failure</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">rpwexp</span>(<span class="dv">10000</span>, </a>
<a class="sourceLine" id="cb5-2" data-line-number="2">            <span class="dt">failRates=</span><span class="kw">tibble</span>(<span class="dt">rate =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">10</span>), </a>
<a class="sourceLine" id="cb5-3" data-line-number="3">                             <span class="dt">duration =</span> <span class="kw">c</span>(.<span class="dv">5</span>,.<span class="dv">5</span>,<span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="kw">plot</span>(<span class="kw">sort</span>(x),(<span class="dv">10000</span><span class="op">:</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">10001</span>,<span class="dt">log=</span><span class="st">&quot;y&quot;</span>, </a>
<a class="sourceLine" id="cb5-5" data-line-number="5">     <span class="dt">main=</span><span class="st">&quot;PW Exponential simulated survival curve&quot;</span>,</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">     <span class="dt">xlab=</span><span class="st">&quot;Time&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;P{Survival}&quot;</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="generating-a-trial" class="section level2">
<h2>Generating a trial</h2>
<p>Ideally, this might be done with a routine where generation of randomization, and time-to-event data could be done in a modular fashion plugged into a general trial generation routine. For now, stratified randomization, piecewise constant enrollment, fixed block randomization and piecewise exponential failure rates support a flexible set of trial generation options for time-to-event endpoint trials. At present, follow this format very carefully as little checking of input has been developed to-date. The methods used here have all be demonstrated above, but here they are combined in a single routine to generate a trial. Note that in the generated output dataset, <code>cte</code> is the calendar time of an event or dropout, whichever comes first, and <code>fail</code> is an indicator that <code>cte</code> represents an event time.</p>
<p>First we set up input variables to make the later call to <code>simPWSurv()</code> more straightforward to read.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">strata &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Stratum=</span><span class="kw">c</span>(<span class="st">&quot;Negative&quot;</span>,<span class="st">&quot;Positive&quot;</span>), <span class="dt">p=</span><span class="kw">c</span>(.<span class="dv">5</span>,.<span class="dv">5</span>))</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">block &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;Control&quot;</span>,<span class="dv">2</span>),<span class="kw">rep</span>(<span class="st">&quot;Experimental&quot;</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">enrollRates &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">rate=</span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>), <span class="dt">duration=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">failRates &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Stratum=</span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;Negative&quot;</span>,<span class="dv">4</span>),<span class="kw">rep</span>(<span class="st">&quot;Positive&quot;</span>,<span class="dv">4</span>)),</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">                    <span class="dt">period=</span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,<span class="dv">4</span>),</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">                    <span class="dt">Treatment=</span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;Control&quot;</span>,<span class="dv">2</span>), <span class="kw">rep</span>(<span class="st">&quot;Experimental&quot;</span>,<span class="dv">2</span>)),<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">                    <span class="dt">duration=</span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">1</span>),<span class="dv">4</span>),</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">                    <span class="dt">rate=</span><span class="kw">log</span>(<span class="dv">2</span>)<span class="op">/</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">9</span>,<span class="fl">4.5</span>,<span class="dv">10</span>,<span class="dv">4</span>,<span class="dv">9</span>,<span class="dv">8</span>,<span class="dv">18</span>))</a>
<a class="sourceLine" id="cb6-12" data-line-number="12">dropoutRates &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Stratum=</span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;Negative&quot;</span>,<span class="dv">4</span>),<span class="kw">rep</span>(<span class="st">&quot;Positive&quot;</span>,<span class="dv">4</span>)),</a>
<a class="sourceLine" id="cb6-13" data-line-number="13">                       <span class="dt">period=</span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,<span class="dv">4</span>),</a>
<a class="sourceLine" id="cb6-14" data-line-number="14">                       <span class="dt">Treatment=</span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;Control&quot;</span>,<span class="dv">2</span>), <span class="kw">rep</span>(<span class="st">&quot;Experimental&quot;</span>,<span class="dv">2</span>)),<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb6-15" data-line-number="15">                       <span class="dt">duration=</span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">1</span>),<span class="dv">4</span>),</a>
<a class="sourceLine" id="cb6-16" data-line-number="16">                       <span class="dt">rate=</span><span class="kw">rep</span>(<span class="kw">c</span>(.<span class="dv">001</span>,.<span class="dv">001</span>),<span class="dv">4</span>))</a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">simPWSurv</span>(<span class="dt">n=</span><span class="dv">400</span>,</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">              <span class="dt">strata =</span> strata,</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">              <span class="dt">block =</span> block,</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">              <span class="dt">enrollRates =</span> enrollRates,</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">              <span class="dt">failRates=</span>failRates,</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">              <span class="dt">dropoutRates=</span>dropoutRates)</a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="kw">head</span>(x) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable</span>(<span class="dt">digits=</span><span class="dv">2</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Stratum</th>
<th align="right">enrollTime</th>
<th align="left">Treatment</th>
<th align="right">failTime</th>
<th align="right">dropoutTime</th>
<th align="right">cte</th>
<th align="right">fail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Negative</td>
<td align="right">0.55</td>
<td align="left">Experimental</td>
<td align="right">0.17</td>
<td align="right">41.25</td>
<td align="right">0.72</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Negative</td>
<td align="right">0.82</td>
<td align="left">Control</td>
<td align="right">0.33</td>
<td align="right">2991.65</td>
<td align="right">1.16</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Positive</td>
<td align="right">1.75</td>
<td align="left">Control</td>
<td align="right">43.63</td>
<td align="right">299.46</td>
<td align="right">45.38</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Positive</td>
<td align="right">2.01</td>
<td align="left">Experimental</td>
<td align="right">37.23</td>
<td align="right">513.35</td>
<td align="right">39.23</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Negative</td>
<td align="right">2.44</td>
<td align="left">Control</td>
<td align="right">25.64</td>
<td align="right">1496.91</td>
<td align="right">28.08</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Negative</td>
<td align="right">3.58</td>
<td align="left">Experimental</td>
<td align="right">2.58</td>
<td align="right">151.90</td>
<td align="right">6.15</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
<div id="cutting-data-for-analysis" class="section level2">
<h2>Cutting data for analysis</h2>
<p>There two ways to cut off data in the generated dataset <code>x</code> from above. The first uses a calendar cutoff date. The output only includes the time from randomization to event or dropout (<code>tte</code>), and indicator that this represents and event (<code>event</code>), the stratum in which the observation was generated (<code>Stratum</code>) and the treatment group assigned (<code>Treatment</code>). Observations enrolled after the input <code>cutDate</code> are deleted and events and censoring from <code>x</code> that are after the <code>cutDate</code> are censored at the specified <code>cutDate</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="kw">cutData</span>(x,<span class="dt">cutDate=</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw">head</span>(y) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable</span>(<span class="dt">digits=</span><span class="dv">2</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">tte</th>
<th align="right">event</th>
<th align="left">Stratum</th>
<th align="left">Treatment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.17</td>
<td align="right">1</td>
<td align="left">Negative</td>
<td align="left">Experimental</td>
</tr>
<tr class="even">
<td align="right">0.33</td>
<td align="right">1</td>
<td align="left">Negative</td>
<td align="left">Control</td>
</tr>
<tr class="odd">
<td align="right">3.25</td>
<td align="right">0</td>
<td align="left">Positive</td>
<td align="left">Control</td>
</tr>
<tr class="even">
<td align="right">2.99</td>
<td align="right">0</td>
<td align="left">Positive</td>
<td align="left">Experimental</td>
</tr>
<tr class="odd">
<td align="right">2.56</td>
<td align="right">0</td>
<td align="left">Negative</td>
<td align="left">Control</td>
</tr>
<tr class="even">
<td align="right">1.42</td>
<td align="right">0</td>
<td align="left">Negative</td>
<td align="left">Experimental</td>
</tr>
</tbody>
</table>
<p>For instance, if we wish to cut the entire dataset when 50 events are observed in the Positive stratum we can use the <code>getCutDateForCount</code> function as follows:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">cut50Positive &lt;-<span class="st"> </span><span class="kw">getCutDateForCount</span>(<span class="kw">filter</span>(x,Stratum<span class="op">==</span><span class="st">&quot;Positive&quot;</span>),<span class="dv">50</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">y50Positive &lt;-<span class="st"> </span><span class="kw">cutData</span>(x,cut50Positive)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="kw">with</span>(y50Positive,<span class="kw">table</span>(Stratum,event))</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt;           event</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt; Stratum     0  1</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt;   Negative 47 51</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt;   Positive 44 50</span></a></code></pre></div>
<p>Perhaps the most common way to cut data is with an event count for the overall population, which is done using the <code>cutDataAtCount</code> function. Note that if there are tied events at the date the <code>cte</code> the count is reached, all are included. Also, if the count is never reached, all event times are included in the cut - with no indication of an error.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">y150 &lt;-<span class="st"> </span><span class="kw">cutDataAtCount</span>(x,<span class="dv">150</span>)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">table</span>(y150<span class="op">$</span>event,y150<span class="op">$</span>Treatment)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt;    </span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt;     Control Experimental</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt;   0      42           61</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt;   1      86           64</span></a></code></pre></div>
</div>
<div id="generating-a-counting-process-dataset" class="section level2">
<h2>Generating a counting process dataset</h2>
<p>Once we have cut data for analysis, we can create a dataset that is very simple to use for weighted logrank tests. A slightly more complex version could be developed in the future to enable Kaplan-Meier-based tests. We take the dataset <code>y150</code> from above and process it into this format. The counting process format is further discussed in the next section where we compute a weighted logrank test.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">ten150 &lt;-<span class="st"> </span><span class="kw">tensurv</span>(y150,<span class="dt">txval=</span><span class="st">&quot;Experimental&quot;</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw">head</span>(ten150) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable</span>(<span class="dt">digits=</span><span class="dv">2</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Stratum</th>
<th align="right">events</th>
<th align="right">txevents</th>
<th align="right">tte</th>
<th align="right">atrisk</th>
<th align="right">txatrisk</th>
<th align="right">S</th>
<th align="right">OminusE</th>
<th align="right">Var</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Negative</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.01</td>
<td align="right">127</td>
<td align="right">63</td>
<td align="right">1.00</td>
<td align="right">0.50</td>
<td align="right">0.25</td>
</tr>
<tr class="even">
<td align="left">Negative</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.04</td>
<td align="right">126</td>
<td align="right">62</td>
<td align="right">0.99</td>
<td align="right">0.51</td>
<td align="right">0.25</td>
</tr>
<tr class="odd">
<td align="left">Negative</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0.06</td>
<td align="right">125</td>
<td align="right">61</td>
<td align="right">0.98</td>
<td align="right">-0.49</td>
<td align="right">0.25</td>
</tr>
<tr class="even">
<td align="left">Negative</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0.06</td>
<td align="right">124</td>
<td align="right">61</td>
<td align="right">0.98</td>
<td align="right">-0.49</td>
<td align="right">0.25</td>
</tr>
<tr class="odd">
<td align="left">Negative</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.11</td>
<td align="right">122</td>
<td align="right">61</td>
<td align="right">0.97</td>
<td align="right">0.50</td>
<td align="right">0.25</td>
</tr>
<tr class="even">
<td align="left">Negative</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.17</td>
<td align="right">121</td>
<td align="right">60</td>
<td align="right">0.96</td>
<td align="right">0.50</td>
<td align="right">0.25</td>
</tr>
</tbody>
</table>
</div>
<div id="logrank-and-weighted-logrank-testing" class="section level2">
<h2>Logrank and weighted logrank testing</h2>
<p>Now stratified logrank and stratified weighted logrank tests are easily generated based on the counting process format. Each record in the counting process dataset represents a <code>tte</code> at which one or more events occurs; the results are stratum-specific. Included in the observation is the number of such events overall (<code>events</code>) and in the experimental treatment group (<code>txevents</code>), the number at risk overall (<code>atrisk</code>) and in the experimental treatment group (<code>txatrisk</code>) just before <code>tte</code>, the combined treatment group Kaplan-Meier survival estimate (left-continuous) at <code>tte</code>, the observed events in experimental group minus the expected at <code>tte</code> based on an assumption that all at risk observations are equally likely to have an event at any time, and the variance for this quantity (<code>Var</code>).</p>
<p>To generate a stratified logrank test and a corresponding one-sided p-value, we simply do the following:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">z &lt;-<span class="st"> </span><span class="kw">with</span>(ten150,<span class="kw">sum</span>(OminusE)<span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">sum</span>(Var)))</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw">c</span>(z,<span class="kw">pnorm</span>(z))</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co">#&gt; [1] -2.03287862  0.02103239</span></a></code></pre></div>
<p>A Fleming-Harrington <span class="math inline">\(\rho=1\)</span>, <span class="math inline">\(\gamma=2\)</span> is nearly as simple. We again compute a z-statistic and its corresponding one-sided p-value.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">xx &lt;-<span class="st"> </span><span class="kw">mutate</span>(ten150,<span class="dt">w=</span>S<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>S)<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">z &lt;-<span class="st"> </span><span class="kw">with</span>(xx,<span class="kw">sum</span>(OminusE<span class="op">*</span>w)<span class="op">/</span><span class="kw">sum</span>(<span class="kw">sqrt</span>(Var<span class="op">*</span>w<span class="op">^</span><span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw">c</span>(z,<span class="kw">pnorm</span>(z))</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co">#&gt; [1] -0.1283508  0.4489357</span></a></code></pre></div>
<p>For Fleming-Harrington tests, a routine has been built to do these tests for you:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">tenFH</span>(<span class="dt">x=</span>ten150,<span class="dt">rg=</span><span class="kw">tibble</span>(<span class="dt">rho=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>),<span class="dt">gamma=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable</span>(<span class="dt">digits=</span><span class="dv">2</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">rho</th>
<th align="right">gamma</th>
<th align="right">Z</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">-2.03</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="right">-1.30</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">-2.16</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-1.96</td>
</tr>
</tbody>
</table>
<p>If we wanted to take the minimum of these for a MaxCombo test, we would first use <code>tenFHcorr</code> to compute a correlation matrix for the above Z-statistics as follows. Note that the ordering of <code>rg</code> and <code>g</code> in the argument list is opposite of the above. The correlation matrix for the <code>Z</code>-values is now in <code>V1</code>-<code>V4</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">x &lt;-<span class="st"> </span>ten150 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tenFHcorr</span>(<span class="dt">rg=</span><span class="kw">tibble</span>(<span class="dt">rho=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>),<span class="dt">gamma=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable</span>(<span class="dt">digits=</span><span class="dv">2</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">rho</th>
<th align="right">gamma</th>
<th align="right">Z</th>
<th align="right">V1</th>
<th align="right">V2</th>
<th align="right">V3</th>
<th align="right">V4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">-2.03</td>
<td align="right">1.00</td>
<td align="right">0.84</td>
<td align="right">0.96</td>
<td align="right">0.92</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="right">-1.30</td>
<td align="right">0.84</td>
<td align="right">1.00</td>
<td align="right">0.66</td>
<td align="right">0.95</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">-2.16</td>
<td align="right">0.96</td>
<td align="right">0.66</td>
<td align="right">1.00</td>
<td align="right">0.79</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-1.96</td>
<td align="right">0.92</td>
<td align="right">0.95</td>
<td align="right">0.79</td>
<td align="right">1.00</td>
</tr>
</tbody>
</table>
<p>We can compute a p-value for the MaxCombo as follows using the <code>pmvnorm</code> function from the <code>mvtnorm</code> package. Note the arguments for <code>GenzBretz</code> which are more stringent than the defaults; we have also used these more stringent parameters in the example in the help file.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co"># compute p-value for MaxCombo</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="kw">pMaxCombo</span>(x)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="co">#&gt; [1] 0.03013652</span></a></code></pre></div>
</div>
<div id="simplification-for-2-arm-trials" class="section level2">
<h2>Simplification for 2-arm trials</h2>
<p>The <code>simfix()</code> routine combines much of the above to go straight to generating tests for individual trials so that cutting data and analyzing do not need to be done separately. Here the argument structure is meant to be simpler than for <code>simPWSurv()</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">strata &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Stratum =</span> <span class="st">&quot;All&quot;</span>, <span class="dt">p =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">enrollRates &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">duration =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">10</span>), </a>
<a class="sourceLine" id="cb17-3" data-line-number="3">                      <span class="dt">rate =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>)</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">                     ) </a>
<a class="sourceLine" id="cb17-5" data-line-number="5">failRates &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Stratum =</span> <span class="st">&quot;All&quot;</span>, </a>
<a class="sourceLine" id="cb17-6" data-line-number="6">                    <span class="dt">duration =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">100</span>),</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">                    <span class="dt">failRate =</span> <span class="kw">log</span>(<span class="dv">2</span>)<span class="op">/</span><span class="kw">c</span>(<span class="dv">9</span>, <span class="dv">18</span>), </a>
<a class="sourceLine" id="cb17-8" data-line-number="8">                    <span class="dt">hr =</span> <span class="kw">c</span>(<span class="fl">0.9</span>, <span class="fl">0.6</span>), </a>
<a class="sourceLine" id="cb17-9" data-line-number="9">                    <span class="dt">dropoutRate =</span> <span class="kw">rep</span>(<span class="fl">0.001</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb17-10" data-line-number="10">                   )</a>
<a class="sourceLine" id="cb17-11" data-line-number="11">block &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;Experimental&quot;</span>, <span class="st">&quot;Control&quot;</span>), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb17-12" data-line-number="12">rg &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">rho =</span> <span class="dv">0</span>, <span class="dt">gamma =</span> <span class="dv">0</span>)</a></code></pre></div>
<p>Now we simulate a trial 2 times and cut data for analysis based on <code>timingType = 1:5</code> which translates to:</p>
<ol style="list-style-type: decimal">
<li>the planned study duration,</li>
<li>targeted event count is achieved,</li>
<li>planned minimum follow-up after enrollment is complete,</li>
<li>the maximum of 1 and 2,</li>
<li>the maximum of 2 and 3.</li>
</ol>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">simfix</span>(<span class="dt">nsim =</span> <span class="dv">2</span>,                  <span class="co"># Number of simulations</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">       <span class="dt">sampleSize =</span> <span class="dv">500</span>,          <span class="co"># Trial sample size</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3">       <span class="dt">targetEvents =</span> <span class="dv">350</span>,        <span class="co"># Targeted events at analysis</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4">       <span class="dt">strata =</span> strata,           <span class="co"># Study strata</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5">       <span class="dt">enrollRates =</span> enrollRates, <span class="co"># Enrollment rates</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6">       <span class="dt">failRates =</span> failRates,     <span class="co"># Failure rates</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7">       <span class="dt">totalDuration =</span> <span class="dv">30</span>,        <span class="co"># Planned trial duration </span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8">       <span class="dt">block =</span> block,             <span class="co"># Block for treatment</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9">       <span class="dt">timingType =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,          <span class="co"># Use all possible data cutoff methods</span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10">       <span class="dt">rg =</span> rg                    <span class="co"># FH test(s) to use; in this case, logrank</span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11">) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">kable</span>(<span class="dt">digits=</span><span class="dv">2</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Events</th>
<th align="right">lnhr</th>
<th align="right">Z</th>
<th align="left">cut</th>
<th align="right">Duration</th>
<th align="right">Sim</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">97</td>
<td align="right">-0.48</td>
<td align="right">-2.36</td>
<td align="left">Planned duration</td>
<td align="right">30.00</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">350</td>
<td align="right">-0.31</td>
<td align="right">-2.87</td>
<td align="left">Targeted events</td>
<td align="right">69.29</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">356</td>
<td align="right">-0.30</td>
<td align="right">-2.87</td>
<td align="left">Minimum follow-up</td>
<td align="right">70.51</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">350</td>
<td align="right">-0.31</td>
<td align="right">-2.87</td>
<td align="left">Max(planned duration, event cut)</td>
<td align="right">69.29</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">356</td>
<td align="right">-0.30</td>
<td align="right">-2.87</td>
<td align="left">Max(min follow-up, event cut)</td>
<td align="right">70.51</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">98</td>
<td align="right">-0.35</td>
<td align="right">-1.70</td>
<td align="left">Planned duration</td>
<td align="right">30.00</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">350</td>
<td align="right">-0.36</td>
<td align="right">-3.35</td>
<td align="left">Targeted events</td>
<td align="right">74.57</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">355</td>
<td align="right">-0.38</td>
<td align="right">-3.55</td>
<td align="left">Minimum follow-up</td>
<td align="right">76.70</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">350</td>
<td align="right">-0.36</td>
<td align="right">-3.35</td>
<td align="left">Max(planned duration, event cut)</td>
<td align="right">74.57</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">355</td>
<td align="right">-0.38</td>
<td align="right">-3.55</td>
<td align="left">Max(min follow-up, event cut)</td>
<td align="right">76.70</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
